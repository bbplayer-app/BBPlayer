# 留下的技术债们

## 更统一和高效的异常处理、记录、上报机制

当前项目内的错误管理比较混乱，尤其是 playerStore 中，很多函数有潜在的抛出错误的可能，都需要用 neverthrow 包装处理（我觉得直接在这些函数中打印错误日志即可，不用留给调用方）。在 playerStore 的调用方，大部分都是 fire-and-forget，但也有小部分情况下需要处理错误，弹出 toast 或上报给 Sentry。

另外还需要进一步明确到底什么错误应该上报到 Sentry，私以为非三方 API 调用的错误都应该上报。

## 日志

针对 Service、Facade 层添加更详细的日志

## 分 P 视频处理

B 站所有视频的唯一可播放单位是 `(bvid, cid)`，但在咱们项目内存在两种入口：

- **整视频入口**（`isMultiPage = false`，无 `cid`，播放器的行为是默认播放第一 P）
- **分 P 入口**（`isMultiPage = true`，`cid` 已知）

这两种入口在逻辑上可能指向同一个视频的第一 P，但由于整视频在大多数情况下需要再请求一次 api 才能获取到 cid，批量导入时容易风控，完全不可行，导入时无法标准化为同一键，导致数据库和 UI 中出现“重复”的两条记录。

解决难点：

1. 靠分 P 的顺序不可靠，UP 主可以删除某一分 P
2. 批量获取 `cid` 成本高，不可行
