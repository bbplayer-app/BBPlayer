appId: com.roitium.orpheus
env:
  COOKIE: 'YOUR_COOKIE_HERE'
---
- launchApp:
    clearState: true

# 1. Onboarding
- runFlow:
    when:
      visible: 'welcome-next-step'
    commands:
      - tapOn: 'welcome-next-step'
      - tapOn: 'welcome-guest-mode'

# 2. Login via Cookie
- tapOn: 'tab-settings'
- tapOn: 'setting-general'
- tapOn: 'cookie-login-button'
- inputText: ${COOKIE}
- tapOn: 'cookie-login-confirm'
# Wait for login processing and toast
- waitForAnimationToEnd
- assertVisible: 'Cookie 已更新'

# 3. Library & Favorites Sync
- tapOn: 'tab-library'
# Ensure we are on the Favorites tab (index 1) if not default, but default is usually 0 (Local).
# The code shows initial route is 'local'. Favorites is key 'favorite'.
# We need to switch tab if necessary. But wait, `[tab].tsx` takes a param.
# Or we can just tap the tab bar item?
# The tab bar uses `react-native-tab-view` with `renderTabBar`.
# It doesn't seem to have testIDs on the inner tab bar items visibly.
# But we can swipe! The order is: Local, Favorite, Collection, MultiPage.
# So swipe left once to go to Favorite.
- swipe:
    direction: LEFT
# Wait for list to render
- extendedWaitUntil:
    visible:
      id: 'favorite-folder-.*'
    timeout: 10000

# Enter first favorite folder
- tapOn:
    id: 'favorite-folder-.*'
    index: 0

# Confirm render (check for title or something, but we just check sync button existence)
- assertVisible: 'playlist-header-main-button'

# Click Sync
- tapOn: 'playlist-header-main-button'
# Assert Sync Started (Toast or Modal)
# "FavoriteSyncProgress" modal opens.
- assertVisible: '同步中...' # Assuming modal title or content

# 4. Playback & Lyrics
# We need to play a song. We might need to wait for sync to finish or just play existing if available?
# If sync is running, we might be blocked?
# The sync modal says `dismissible: false`.
# We should wait for sync to finish.
- extendedWaitUntil:
    notVisible: '同步中...'
    timeout: 60000

# Now we should see tracks in the list (if sync worked)
- tapOn:
    id: 'track-item-.*'
    index: 0

# Player should open
- assertVisible: 'player-cover'

# Open Lyrics
- tapOn: 'player-cover'
- assertVisible: 'player-lyrics-view'
